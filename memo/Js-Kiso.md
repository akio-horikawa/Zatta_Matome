# JavaScript_学習メモ

---

このメモは、 __JavaScript__ を学習するために、1~10までをマメに記述する予定のメモ。三日坊主で終わらないことを切に願っている。因みに学習用に教本として【オライリージャパン】の【JavaScript_第7版】 __（税込5,060円）__ を使用している。本当に三日坊主で終わらないようにしないと後悔することになる。
（追記）多少なり飛ばしている部分もあるので、不明点は都度調査すべき。

---

## 目次 <a id = mokuji></a>
[１章 JavaScript概要](#1)  
[２章 字句構造](#2)
[３章 型・値・変数](#3)  
[４章 式と演算子](#4)  

---
<a id = 1></a>
## １章 JavaScript概要

JavaScriptとは、Webのためのプログラミング言語。ほぼ全てのWebサイトで使用されていて、スマホ等の最新ブラウザにおいても全てにJavaScriptインタプリタが搭載されている。

→　インタプリタ　：　通訳者。Compでプログラムを処理する方法の一つ。実行時にソースコードを一行ずつ機械語に変換するのが特徴。

JavaScriptはJavaと名前が似ているが両者は全く違う言語であり、似ているのは名前のみである。最初こそスクリプトとして実装されたJavaScriptは現在では大規模ソフトウェアを作成する際にまで利用されている。

全ての言語には負担軽減のためのプラットフォームや標準ライブラリが含まれているが、コアJavaScript言語には最小限のAPIのみが定義されている。ホスト環境で提供される前提のため、入出力機能は含まれていない。Web上でのJavaScriptのコードはユーザーのマウスやキーボードからの入力、Webサーバからの情報の受け取りを行うことができる。

私個人としては、この場所に限ってはWebシステムのためではなく、JavaScriptという言語の基礎的な、基本的な仕様等に注目して学んでいきたい。

#### いつもの

ブラウザで開発者ツールなどからコンソールを開く他、Node.js等を導入してターミナルからJavaScriptの簡単なコードを試すことができる。`console.log("Hello World!")`を動作させてみれば、見慣れた表示がコンソールで確認できるはず。

[１章 JavaScript概要](#1)
[目次](#mokuji)  

---

<a id = 2></a>
## ２章 字句構造

JavaScriptは大文字小文字を区別する。変数や関数名、識別子では厳密に区別されるために気を付ける必要がある。トークンを区切る空白の他、一般的に改行を無視するため、プログラム内では自由に空白と改行を使用可能である。

→　トークン　：　証拠。ソースコード上でそれ以上分割できない最小単位の文字列。

##### コメント

コメントは `//ここにコメント` や `/* ここにコメント */` のように記述する他、 `// => 値 or "値" :ここにコメント` のように記述することができる。最後のコメント方法はアサーションとして機能し、コードの検証に利用することが可能。（それとは別に検証用のコードが必要になる）

→　アサーション　：　自己主張。プログラミングにおいて、あるコードが実行される時に満たされるべき条件を記述して実行時にチェックする仕組みのこと。

アサーション用のコメント記法には他に `//a == 値` 、 `// !例外` のようなものも存在する。

##### 識別子

識別子は変数や関数、クラスに付けられる名前のこと。先頭は数字以外でなければならず、予約語である元々設定されている語句を使用することはできない。

##### 予約語

予約語はJavaScript言語の一部として使用されているため変数やクラスの名前として使用することは不可である。 `from` 、 `of` 、 `get` 、 `set` 等は、予約語として使用される場面が少ない上に、識別子として使用されやすいものなので利用すべき。以下は予約語の例。

```
as async await break case catch class const continue 
debugger default delete do else export extends false 
finally for (from) function (get) if import in instanceof 
let new null (of) return (set) static super switch target
this throw true try typeof var void while with yield
//以下は将来的に予約語とされている。
enum implements interface package private protected public
```

また、特殊な理由で特定状況下では `arguments` と `eval` は識別子として利用不可のため、普段から仕様は避けるべきである。

##### Unicode

JavaScriptはUnicode文字コードを使用して、文字列やコメントを記述できる。しかし、識別子に関してはASCII文字か数字を使用するのが一般的となっている。慣習なので気にせずUnicodeを識別子として使用することは可能。

##### エスケープシーケンス

エスケープシーケンスとは、Unicodeを表現するために並べられたASCII文字の並びのこと。全ての環境でUnicodeが表示できるわけではないために、 `\u` で始まり、後ろに4文字の16進数を記述する。その他、中括弧内で1~6文字の16進数を記述することで表せる。コメント内にもエスケープシーケンスを記述できるが、単にASCII文字として扱われるだけでUnicode文字として解釈されることはない。

##### Unicode正規化

JavaScriptではUnicodeの正規化処理は行わないため、Unicode文字を使用する場合はエディタ等で正規化を行うと見た目は同じでも実際にはデータが違うような識別子に悩まされなくなる。

##### 省略可能セミコロン

JavaScriptでは文末のセミコロンは省略可能。しかし、文の終端を示すものなので有って悪い事はない。セミコロンがない場合は改行を終端と解釈するが、括弧などで文が始まった時、前の文章の続きだと解釈されてしまう場合があるため、中々良くない状況になる。これを避けるために文の最初にセミコロンを記述する人もいる。その他にも、 `++` や `=>` 等は一つの文で表した方が良い。

[２章 字句構造](#2)
[目次](#mokuji)  

---

<a id = 3></a>
## ３章 型・値・変数

##### 型

JavaScriptの型には基本型とオブジェクト型が存在する。基本型には数値や文字列、論理値がある。また、JavaScriptの特殊な値である `null` や `undefined` も基本型の値である。それ以外の値がオブジェクト、プロパティの集合体である。

→　プロパティ　：　属性。オブジェクトの状態や属性のことをいう。

##### 数値

JavaScriptにおいて数値型は整数と大凡の実数を64ビット浮動小数で表す。プログラム内に直接記述される数字は数値リテラルと言い、全ての数値リテラルは前に `-` をつけることで符号を反転できる。

##### 整数リテラル

10進数は数字をただ並べるのみ。
`1000000`
16進数は先頭が 0x or 0X で後ろには16進数値が続く。
`0xff // => 255`

##### 浮動小数点リテラル

JavaScriptでは実数は浮動小数点リテラルを使用して表す。先頭を整数部、続いて小数点、小数部という形式である。指数は e or E の次に (+) or (-) 、次に整数指数という形式で小数部の後ろに記述することになる。

また、数値リテラル内ではアンダースコアが自由に使えるため、見やすさを重視するなら活用すべきである。

##### JavaScriptでの算術演算

JavaScriptの基本的算術演算子には、 加算(+)、減算(-)、乗算(*)、除算(/)、剰余(%)、べき乗(**)が使用可能であり、より複雑なものはMathプロパティに定義されている。

JavaScriptでは演算中にオーバーフローやアンダーフローが起きてもエラーが発生しない。

→　オーバーフロー　：　上桁あふれ。結果が表現可能な最大値よりも大きくなってしまったこと。
→　アンダーフロー　：　下桁あふれ。結果が表現可能な最小値よりも0に近づいたときのこと。

JavaScriptでのオーバーフローは、正の値ならば無限大 `Infenity` 、負の値ならば負の無限大数値 `-Infenity` を返す。アンダーフローならば、 `負の0` という特殊な値を返す。 `負の0` は通常の0と区別しないため気にする必要はない。
0除算に関してもエラーは出ず `Infenity` 等が返されるが、0を0で割った時に関しては `NaN` が返される。これは不定を表し、他にも無限大を無限大で割った時や、負数の平方根を求めたとき、数値に変換できないオペランドに対して演算を行った場合にも出力されてしまう。

→　オペランド　：　被演算子。コンピュータ演算における値や変数。演算子によって演算の対象になるもの。

`NaN` はどの値とも等しく扱われない。 `x == NaN` は判定できず、正しい結果を得たいのなら `x != x` のような形で記述する必要がある。（ `Number.isNaN(x)`  でも良い）引数が `NaN` か数値に変換できないときに `true` が返される。同じように `Number.isFinite()` は `NaN` や無限大以外なら `true` を返してくれる。

##### 2進浮動小数点

JavaScriptでは実数の表現には限度があり、2進数表記のために1/2や1/8のような少数は正確に表現できるものの1/10など人にとって利用しやすいものに関しては非常に近い値を出力する。尚、十分な精度は確保されているため0.1をほぼ近似表現することは可能になっている。

##### BigIntによる任意精度整数

BigIntとは64ビット整数を表現するために導入されたもの。数字文字列の最後に小文字のnを記述して先頭には何も付けないと10進数を表現できる。先頭に0b、0o、0xを記述することでそれぞれが2進数、8進数、16進数を表現できる。 `BigInt()` を使うことで通常の値や文字列をBigIntの値に変換可能。演算に関しては通常のオペランドとの併用は出来ないので注意されたし。また、BigIntは大きな数（数千桁）を表現できるもののタイミング攻撃に弱く、また整数しか表現できないという特徴がある。

→　タイミング攻撃　：　アルゴリズムの動作特性を利用したサイドチャネル攻撃。暗号処理のタイミングが暗号鍵の論理値により変化することを利用して暗号化や復号に要する時間から暗号鍵を推定するもの。
→　サイドチャネル攻撃　：　電子機器の物理量を観測することで内部情報を取得する攻撃手法。

##### 日付・時刻

JavaScriptでは、日付や時刻を表現、操作するDateクラスが用意されている。
```
let timestamp = Date.now(); // 現在時刻（数値）
// ↑ 何に使うのかは謎
let now = new Date(); // 現在時刻のDateオブジェクト
let ms = now.getTime(); // ミリ秒単位のタイムスタンプ（数値）
// ↑ 何に使うのかは謎
let iso = now.toISOString(); // 標準形式の文字列に変換？
// ↑ Dateオブジェクトを文字列にするもの
```
<br>

##### テキスト

文字列はUnicode文字を表す16ビット値の並びの不変のデータ。16ビット値で収まらない位置のUnicode文字は2つの16ビット値（サロゲートペア）で表す。文字列は反復可能で `for` 等で実際の文字に対して反復処理を行える。

文字リテラルに関してはプログラム中で文字列を `''`  `""`  ` `` ` で囲むことで記述可能。それぞれを併用することもでき、文字列中に ` `` `を使用することでJavaScriptのコードを文字列に補完することも可能。

また、文字列を複数行に分けて記述する際は、 `\` を末尾に記述することでその直後の改行をリテラルに含まずに読み込むことができる。 ` `` ` で囲まれた中は改行が含まれていても分割可能。アポストロフィ等が文字列に含まれる場合も `\` でエスケープする必要がある。エスケープシーケンスは種類があるので都度確かめられたし。

JavaScriptでは `+` で文字列の加算が可能。また、 `==` `!==` を使用することで比較が可能である。文字列の長さの調査には `s.length` を使用する。 `length` プロパティ以外にも文字列を操作するAPIは存在しているが数が多いので都度調べられたし。

文字列が ` `` ` で囲めるようになったのはJavaScriptがES6になってから。これは、ただの文字列ではなく、テンプレートリテラルと呼ばれる。 `${ text }` このように囲まれたテキストは式として評価され文字列に変換されテンプレートリテラルに挿入される。また、最初のバッククォートの前に関数名（タグ）を付けるとテンプレートリテラル内のテキストや式は関数に渡され戻り値になる。HTMLやSQLのエスケープ等に利用できる。

##### 論理値

論理値は `true` `false` が返されるもの。 `a === 0` であればaが0ならば真となり、 `true` 違うのなら偽となって `false` を返す。主に制御構文で使われる。これに関しては他のプログラミング言語と大差ないだろう。

##### nullとundefined

JavaScriptの `null` は値が存在しないということ。 `null` に対してtypeof演算子（対象のデータ型を文字列で返すもの）を使用すれば "object" という値が返ってくる。つまりは、 `null` は __オブジェクトが存在しない__ ことを表すもの。他にも __値がない__ ことを表すときにも使用されるが、JavaScriptには  `undefined` がある。こちらは未定義を表すもので、値がない、存在しないことを表すが、こちらは初期化されていないものや宣言されていない値を指す。また、 `undefined` にtypeofを使うと `undefined` が返ってくる。

`null` `undefined` はどちらも値がないことを表し、プロパティやメソッドを持たず、 `==` では真となるが、（ `===` では区別可能）`undefined` のほうは主にエラーというか予期していない不具合やミスによって出力されることが多い。どちらか一方を使うような場合ならば `null` の方がいいかもしれない。

##### Symbol

SymbolはES6から追加された文字列ではないプロパティ名。一般的なプロパティは文字列ですがSymbolを使用できるようになったということ。Symbolにはリテラルが存在せず、 `Symbol()` で値を呼び出せば同じ値は二度返すことがない。同じ引数を渡したとしても、同じ値は返ってこない。利点としては同じプロパティ名を使用してしまい既存のものを上書きする心配がいらない点。

Symbolには文字列引数を渡すことができ、その場合は `toString()` で文字列引数の出力を得られる。

##### オブジェクト

グローバルオブジェクトとは、通常のJavaScriptオブジェクトだが、非常に重要なもの。システム起動時に生成され基本的なプロパティを生成し初期化する。デフォルトで使用できていた定数や関数もこれに含まれているのだから重要性はよく理解できる。

オブジェクトは基本型の値とはしっかりと違いがある。基本型が不変であり、値で比較する（文字列ならば同じ長さで各インデックスの文字が同じ場合には等しいと判定する）のに対し、オブジェクトは可変で、値をでは比較しない。オブジェクトは参照で比較すると言い、基本型に対して参照型と呼ぶこともある。同じオブジェクトを参照している時に等しいと判定する。
```
a = 0;
b = 0;
a === b; // => false

a = [];
b = a;
a === b; // => true
```
<br>

##### 型の変換

JavaScriptでは必要とする値の型について柔軟な対応をする。数値を文字列に、文字列の数の演算結果を数値に、また、数値に変換できない文字列を変換しようとすれば `NaN` を返してくれる。真偽の10変換よろしく基本型から基本型への変換はわかりやすく簡単だが、オブジェクト型が関わるとそうはいかない。また、明示的に変換をすることもできる。 `Boolean()` `Number()` `String()` 関数を想像すれば理解も容易い。

オブジェクトから基本型への変換はオブジェクトの種類によって変換規則が変わるため複雑化している。変換規則には優先する対象別に3つのアルゴリズムに分けられる。文字列優先、数値優先、それ以外（優先度無）である。最後の優先度無ではDate以外は文字列優先でそれ以外は数値優先が設定されている。 __あとここで参考にしている本に誤字を見つけた。__

論理値への変換は単純で、すべてのオブジェクトは `true` に変換される。

文字列への変換は、まず基本型の値に変換してから必要があれば文字列に変換という流れなのだが、ここでも独自にルールが設定されている。
→ 理解出来次第追記

数値への変換は、文字列の変換と同じような流れで基本型の値に変換してから数値へという流れだが、文字列の変換とは違うルールで変換される。
→ 理解出来次第追記

##### 変数の宣言と代入

ようやっとここまで来た。
変数は識別子を付けることで区別できるようにして、利用するもの。値に名前を付けることは変数に値を代入すると言う。永続的な値の代入ならば変数というよりは定数という方が正しい。

JavaScriptでは現在、 `let` `const` を使用して変数の宣言を行う。2つの違いは再代入できるか否か。 `let` は再代入可なのでよく使用するイメージ。 `const` は再代入不可ということで宣言自体は少なくとも呼び出す回数は多いイメージ。他にも関数無や `var` があるがこれは扱いが難しいどころかミスの原因になり得るので使用は非推奨。（宣言した変数がグローバルスコープ化する等の特徴があるが、再宣言可能というとんでもない仕様。巻き上げされるという特徴も持ち、宣言のタイミングがズレにズレ、undefinedが多発する可能性あり）
ソースコード内の変数の有効範囲をスコープと言うが、 `let` `const` はブロックスコープと言って、それらがあるコードのブロック内で有効となる。ブロック外で宣言した時はグローバルスコープ、つまり全体で有効になる。となると本当に `var` の使いどころはわからない。

JavaScriptではCやJavaと違い型を指定する必要がない。とある変数に数値を代入した後に文字列を代入してもエラーにならない。
→ もちろんこんなことをしていいわけではない。（エラーが出ないだけ）

##### 分割代入

活用できれば配列を返すのが楽になる。見た方が早い。
```
let [x,y] = [1,2]; // x == 1, y == 2
[x,y] = [y,x]; // xとyが入れ替わる
[x,y]; // => [2,1]

let [a,b] = [1]; // => a == 1, b == undefined
[a,b] = [1,2,3]; // => a == 1, b == 2
[,a,,b] = [1,2,3,4]; // => a == 2, b == 4
// 配列からの分割代入時に使われていない値を纏めたい場合
[c, ...d] = [1,2,3,4]; // d == [2,3,4]
```
→ 追記の必要があるかもしれない。

[３章 型・値・変数](#3) 
[目次](#mokuji)  

---

<a id = 4></a>
## 4章 式と演算子

プログラムにおける式は、Javaインタプリタが評価し、値を生成できるもののこと。変数名も式の一種であり、評価されて変数に代入され値とみなされる。配列や関数呼び出しの式もまた同じようにオブジェクトになる式と引数として使われる式から構成されている。値の生成に値を組み合わせて行う場合は演算子が使用される。演算子が各値から新しい値を生成し返す。

##### 単項式

単純で他の要素を持たない式を単項式と呼ぶ。リテラル（定数値）やJavaScriptキーワード、変数参照等。これまで散々リテラルと呼んでいたものは `"hello!"` のような値単体のこと。

##### オブジェクト・配列の初期化子

新たに生成されるオブジェクトや配列の値になる式のことをそれらの初期化子という。オブジェクトリテラル、配列リテラルとも呼ばれる。他のリテラルと違い、単項式ではなく、要素の値をしているため複数の式で構成されている。

##### 関数定義式

その名の通り関数の定義をする式。オブジェクトリテラルのようにこちらも関数リテラルと呼ばれることがある。一般的に `function` に続いて要素を記述することで丸括弧内にブロックを記述する形になる。
```
let kansu = function(x) { return x * x };
```

##### プロパティアクセス式

オブジェクトプロパティの値や配列の要素を呼び出す式。式、ピリオド、識別子という順で書く。
```
const acc = {
    x : 1,
    y : {z : 2},
}
const a = [o, 3, [4, 5]];

acc.x; // => 1 : acc内のxの値
acc.y.z; // => 2 : acc内のy内のzの値
o["x"]; // => 1 : oの中のxの値
a[1]; // => 3 : aのインデックス1の要素
a[2]["1"]; // => 5 : a[2]のインデックス1の要素
a[0].x; // => 1 : a[0]のプロパティxの値を出力
```

どのプロパティ式を使おうともピリオドや括弧の前から評価される。また、評価された値が `Null` `undefined` ならば `TypeError` を返す。プロパティが存在しない場合は `undefined` を返す。

##### 条件付きプロパティアクセス

 `Null` `undefined` が返されたときにエラーが出てしまうことを防ぐため、 `?.` `?.[式]` の構文を使用する。オプショナルチェイニングとも呼ばれる。

 ##### 呼び出し式

 呼び出し式は関数やメソッドの実行のための構文。関数式の後に丸括弧、その中に引数式を記述する。

 呼び出しにも条件付き、つまり `?.()` のような形のエラー回避方法がある。

##### オブジェクト生成式

新たなオブジェクトの生成をするためコンストラクタと呼ばれる関数を呼び出し、オブジェクトのプロパティを初期化する。呼び出し式に近い形だが、 `new` で記述する違いがある。
```
new object();
new Object;
```
引数を渡さない場合は括弧は省略可。

##### 演算子

演算子は算術式や比較式、論理式、代入式で使用される。基本は記号だが、 `delete` `instanceof` のようなキーワードで表すものもある。

演算子はオペランドの数で大きく3つに分けられる。基本的な二つの式を組み合わせて算術する二項演算子、1つの式を変換する単項演算子、最後に、三項演算子。JavaScriptでは三項演算子は `?:` のみ。

JavaScriptでは演算子は必要に応じてオペランドの型を変換する。 `"3" * "5"` も問題なく算術処理を行い、数値の15を返す。オペランドの型で動きが変わる演算子も存在する。＋演算子の場合は左辺値が数値ならば算術、文字列なら連結する。

演算子は優先度が存在し、式の中で優先度を設定するならば()で囲ってやるといい。式は基本的には左から右へ処理されるが、乗演算子、代入演算子、条件演算子は右から左へ処理される。

