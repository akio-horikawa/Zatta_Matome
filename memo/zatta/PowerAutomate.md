# PowerAutomate

アプリとサービス間の自動化されたワークフローを作成するツール。作成したフローを自動起動、Webやモバイルアプリから起動可能。

## 基本的なこと

#### フィルタクエリ

Sharepoint「複数の項目を取得」で設定することになるもの。
追加しなくとも100件分のデータは取得できるものの、警告が表示される。

| text | 説明        |
| ---- | ----------- |
| ge   | 以上        |
| lt   | 未満        |
| eq   | イコール    |
| ne   | Notイコール |

## 気づいたこと（雑多なメモ）

#### TryCatch内で変数の宣言ができない

☆TryCatchは「Control」の「スコープ」から設定可能。  
SharePointから「複数項目の取得」を設定「ForEach」が自動生成され、
Forが量産されていた時に、後ろの処理の回数を制限したいので変数を宣言していたら発生した。

TryCatchの外、トリガーの下あたりで宣言して事なきを得た。

#### フィルタークエリで値には''が必要

動的な値を設定した時でも''を忘れているとエラーを吐くので注意。
**フィルタークエリに限らず、ちょこちょこ''が要求される。**

#### 5000件問題について

Office365周りで過去の仕様から引き続いている設定。データを一度に操作できる上限が5000件というもの。
そもそも通常では5000件に設定できなかったり、5000件を超えた時に処理速度が低下するなど。

SharePoint「複数の項目の取得」アクションでは、デフォルトで取得できるデータ数は100件。
設定から改ページをONにして、しきい値を任意の数にするか、上から順に取得で任意の数を設定する必要がある。
また、フィルタクエリでも設定によっては5000件以上のデータを取得可能な模様。

#### SharePointリストのDate型にNullもしくは空のデータが入らない

SharePointでまとめるべきか。
PowerAutomate上ではDate型という指定は存在せず、String/Date型のような形で表示される。

SharePoint「項目の作成」などでDate型のカラムにデータを入力する際、空のデータやNullは型で弾かれてしまう。
有効な策が思いつかない上に、情報が見つからなかったので、現状は条件分岐でそもそも追加するかどうかを分岐させている。

#### 作成アクションについて

単純に定数を作成できる。使用するのが一度きりだったり、重要度の低いものであれば変数よりもアクション数が少なく済むので有用かも。
変数だと、初期化→設定が必要なところを、作成アクションでは、アクション名と入力する値を設定すればアクション名の出力として値を利用できる。
★250207追記→作成アクションは作成した地点での仕様が主で後々で利用したい場合は無理せず変数を追加した方が早い。

#### Appsなど手動実行でトリガーされるフローに関して

フローの設定に実行ユーザーの設定がある。
ここが対応する箇所（SharePointやExcelなど）に権限のあるユーザーが指定されていないと、トリガーしたユーザーの権限を参照してしまい、処理が失敗する。権限を持つユーザーを設定することを忘れずに。

